<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Index</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js"></script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="./style.css"/>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">

    <link rel="stylesheet" type="text/css" href="./style.css"/>
    <style>
        ::placeholder {
            text-align: left;
            padding-left: 15px;
        }
        .form-control{
            background-color: rgb(238, 238, 238);
            border: None
        }
        #navicon .nav-link:hover {
            color: rgb(198, 15, 45);
        }
        .carousel-inner {
            border-radius: 25px;
        }
        .card-img-top{
            border-radius: 30px;
            padding: 20px;
            width: 250px;
            height: 250px;
            object-fit: cover;
        }
        .img-fluid{
            border-radius: 25px;
            width: 90px;
            height: 90px;
            padding: 10px;
            object-fit: cover;
        }
        .card{
            border-radius: 20px;
            box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
            border: none;
            overflow: hidden;
        }
        .card-body{
            padding: 25px;
            margin-top: -15px;
        }
        .card:hover {
            box-shadow: rgba(100, 100, 111, 0.25) 0px 7px 29px 0px;
            transition: box-shadow 0.3s ease-in-out;
        }
        .form-control:hover{
            background-color: rgb(228, 228, 228);
        }
        #back{
            text-decoration: none;
        }
        #cart{
            box-shadow: rgba(149, 157, 165, 0.2) 0px 8px 24px;
            top: 75px;
        }
        .card.cart-card{
            background-color: white;
        }
        .card.cart-card:hover{
            background-color: rgb(246, 246, 246);
        }
    </style>
</head>
<body class="bg-light" data-bs-target=".navbar" data-bs-offset="50">

    

    <nav class="navbar navbar-expand navbar-light fixed-top bg-light">
        <div class="container">
            <a class="navbar-brand"><img src="PastaLavista.PNG" width="130"/></a>
            <ul class="navbar-nav sm-icons" id="navicon">
                <li class="nav-item">
                    <a href="#cart" class="nav-link me-auto">
                        <h4 class="d-inline"><i class="bi bi-bag-fill"></i></h4>
                        <span class="badge bg-danger rounded-pill fs-10"></span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="http://45.141.27.252:3001/" class="nav-link">
                        <h4><i class="bi bi-person-circle"></i></h4>
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="carousel slide shadow" id="slider1" data-bs-ride="carousel" style="border-radius: 25px; margin-top: 75px;">
            <ol class="carousel-indicators">
                <a data-bs-target="#slider1" data-bs-slide-to="0" class="active"></a>
                <a data-bs-target="#slider1" data-bs-slide-to="1"></a>
                <a data-bs-target="#slider1" data-bs-slide-to="2"></a>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img src="pro3.jpg" class="d-block w-100">
                </div>
                <div class="carousel-item">
                    <img src="pro4.jpg" class="d-block w-100">
                </div>
                <div class="carousel-item">
                    <img src="pro2.jpg" class="d-block w-100">
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#slider1" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#slider1" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>

        <div class="row row-cols-sm-1 mt-5">
            <div class="row align-items-center" style="margin-bottom: -20px;">
                <div class="col-md-8">
                    <div class="ps-5">
                        <h3 class="display-5">Menu</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-8">
                <div class="row row-cols-1 row-cols-sm-1 row-cols-md-2 row-cols-xl-3 g-4 py-5 align-items-stretch">
                    
                        <% products.forEach(product => { %>
                            <div class="col">
                                <div class="card h-100 d-flex flex-column justify-content-between">
                                    <img src="<%= product.product_image %>" class="card-img-top w-100">
                                    <div class="card-body">
                                        <h4 class="card-title"><%= product.product_name %></h4>
                                    </div>
                                    <div class="p-4 d-flex justify-content-between align-items-end">
                                        <h3 class="text-danger"><%= product.product_price %>$</h3>
                                        <form method="post" action="/add_cart">
                                            <input type="hidden" name="product_id" value="<%= product.product_id %>" />

                                            <input type="hidden" name="product_image" value="<%= product.product_image %>" />
    
                                            <input type="hidden" name="product_name" value="<%= product.product_name %>" />
    
                                            <input type="hidden" name="product_price" value="<%= product.product_price %>" />
    
                                            <button class="btn btn-danger">  <i class="bi bi-bag"></i> Add to Basket</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                    
                </div>
            </div>

            <div class="col-md-4">
                <div class="container my-5 pb-5 rounded-4 sticky-top" style="background-color: white;" id="cart">
                    <div class="mb-5">
                        <h3 class="display-5 fs-1 text-center py-5 fw-light text-danger"><i class="bi bi-bag"></i> My Basket</h3>
                        <% 
                            if(cart.length > 0)
                            {
                                let total = 0;
    
                                cart.forEach(item => {
                        %>
                        
                        <div class="card cart-card" style="max-height: 150px; box-shadow: none;">
                            <div class="row g-0">
                                <div class="col-md-3">
                                    <img src="<%= item.product_image %>" class="img-fluid" alt="...">
                                </div>
                                <div class="col-md-9">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-6 text-start mt-1">
                                                <h4 class="card-title fs-5"><%= item.product_name %></h4>
                                            </div>
                                            <div class="col-6 text-end mt-1">
                                                <h4 class="text-danger fs-5"><%= item.product_price %> $</h4>
                                            </div>
                                            
                                        </div>
                                        <div class="row">        
                                            <div class="col-6 text-start">
                                                <span class="text-muted px-2"><%= item.quantity %></span>
                                            </div>
                                            <div class="col-6 text-end">
                                                <button type="button" class="btn btn-outline-danger btn-sm" onclick="remove_item(<%= item.product_id %>)">Remove</button>
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <%
                                total += parseFloat(item.quantity) * parseFloat(item.product_price);
                            })
                        %>
                        <div class="mx-4" style="margin-bottom: -50px;">
                            <hr/>
                            <div class="row pt-2">
                                <div class="col-6">
                                    <h4 class="text-start">Sub-Total</h4>
                                </div>
                                <div class="col-6">
                                    <h4 class="text-end"><%= total %> $</h4>
                                </div>
                            </div>
                        
                            <div class="pt-2">
                                <form method="POST" action="/checkout">
                                    <input type="hidden" name="total" value="<%= total %>" />

                                    <div class="ms-auto d-grid col-6">
                                        <button type="submit" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#qr">Checkout</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <div class="modal fade" id="qr" data-bs-keyboard="false" tabindex="-1" aria-labelledby="head" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered" style="max-width: 350px;">
                            <div class="modal-content rounded-4">
                                <div class="container">
                                    <div class="pt-3">
                                        <div class="pt-1">
                                            <h1 class="text-danger text-center"><i class="bi bi-credit-card-fill"></i> Payment</h1>
                                        </div>
                                        <!--<hr class="mx-4" style="margin-top: -5px;"/>-->
                                    </div>
                                    <div class="modal-body text-center pt-3">
                                        <img class="" src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS03N6U8egHJfFlWXoL0G3snsgyQyBjAnIKsEV8UCjxag&s" id="qrpic"/>
                                        <p class="pt-3 fs-5 fst-italic text-muted">นายกรวิชญ์ ชูน้อย</p>
                                        
                                        <div class="row pt-3 ps-3 pe-4 pb-3">
                                            <hr style="width: 260px;"/>
                                            <div class="col-6">
                                                <h3 class="text-start">Totals : </h3>
                                            </div>
                                            <div class="col-6">
                                                <h3 class="text-end text-danger" id="totalAmount" name="total" ><%= total %> $</h3>
                                            </div>                                                             
                                        </div>    
                                    </div>
                                </div>
                                
                            </div>
                        </div>
                    </div>
                        <%
                            }
                            else
                            {
                        %>
                                <h4 class="card-title text-center fw-light fst-italic">Your basket is empty</h4>
                        <%
                            }
                        %>
                    </div>
                    
                </div>
                
            </div>

        </div>

        
        
    </div>
    
</body>

<footer>
    <div class="container-fluid bg-dark px-5">
        <div class="row">
            <div class="col-sm-2"></div>
            <div class="col-sm-3 px-5 pt-5 pb-3">
                <h5 class="fw-light text-light">Help&Service</h5>
                <p class="fs-6 fw-lighter text-light">
                    Contact Us<br>
                    Locations<br>
                    FAQs & Help<br>
                    Nutrition
                </p>
            </div>
            <div class="col-sm-3 px-5 pt-5 pb-3">
                <h5 class="fw-light text-light">Our Policies</h5>
                <p class="fs-6 fw-lighter text-light">
                    Privacy<br>
                    Terms & Condition<br>
                    PDPA
                </p>
            </div>
            <div class="col-sm-4 px-5 pt-5 pb-3">
                <h5 class="fw-light text-light">Follow Us</h5>
                <p class="fs-6 fw-lighter text-light">
                    Facebook<br>
                    Instragram<br>
                    About Us
                </p>
            </div>
        </div>
    </div>
</footer>
<script>

    function remove_item(item_id)
    {
        if(confirm("Are you sure you want to remove it?"))
        {
            window.location.href = `/remove_item?id=${item_id}`;
        }
    }


</script>
</html>
